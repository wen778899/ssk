# /.htaccess
#
# 这是解决持续性CORS和路径问题的最终配置文件。
# 它放置在项目的根目录，以确保其规则被应用。

<IfModule mod_rewrite.c>
  RewriteEngine On

  # --- 规则1: 透明地重写旧的API路径 ---
  # 将所有对 /backend/api/ 的请求，在服务器内部重写到 /api/
  RewriteRule ^backend/api/(.*)$ /api/$1 [L,NC]
</IfModule>

<IfModule mod_headers.c>
  # --- 规则2: 强制为所有来自您前端的请求添加CORS头部 ---
  # 这确保了无论是OPTIONS预检请求还是实际的API请求，都能得到CORS许可。
  SetEnvIf Origin "https://gewe.dpdns.org" AccessControlAllowOrigin=$0
  Header set Access-Control-Allow-Origin %{AccessControlAllowOrigin}e env=AccessControlAllowOrigin
  Header set Access-Control-Allow-Methods "GET, POST, OPTIONS"
  Header set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
  Header set Access-Control-Allow-Credentials "true"
</IfModule>
